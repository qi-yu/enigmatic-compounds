---
title: "Enigmatic Compounds"
author: "Qi Yu"
date: "2024-03-01"
output: html_document
---

```{r}
library(ordinal)
library(dplyr)
library(knitr)
library(ggplot2)
library(ggpubr)
```


# 1. Data preprocessing

```{r}
answers_raw <- read.csv2(file = "./data/data.csv", sep = ",")
answers_raw <- answers_raw[grep("L_[KPN]", answers_raw$item), ]
kable(head(answers_raw)) 
```

```{r}
l1 <- c("L_K1", "L_P2", "L_N3", "L_K4", "L_P5", "L_N6", "L_K7", "L_P8", "L_N9", "L_K10", "L_P11", 
        "L_N12", "L_K13", "L_P14", "L_N15", "L_K16", "L_P17", "L_N18", "L_K19", "L_P20", "L_N21")

l2 <- c("L_P1", "L_N2", "L_K3", "L_P4", "L_N5", "L_K6", "L_P7", "L_N8", "L_K9", "L_P10", "L_N11", 
        "L_K12", "L_P13", "L_N14", "L_K15", "L_P16", "L_N17", "L_K18", "L_P19", "L_N20", "L_K21")

l3 <- c("L_N1", "L_K2", "L_P3", "L_N4", "L_K5", "L_P6", "L_N7", "L_K8", "L_P9", "L_N10","L_K11", 
        "L_P12", "L_N13", "L_K14", "L_P15", "L_N16", "L_K17", "L_P18", "L_N19", "L_K20", "L_P21")

answers_raw <- answers_raw %>%
   mutate_if(is.character, as.factor) %>% 
   mutate(
     list = case_when(
       is.element(item, l1) ~ 1,
       is.element(item, l2) ~ 2,
       is.element(item, l3) ~ 3),
     list = as.factor(list),
     read_time = as.numeric(gsub("(\\[|\\])", "", read_time)),
     response_1 = as.factor(response_1)
)

kable(head(answers_raw))
```

```{r}
answers_raw$conditions <- relevel(answers_raw$conditions, ref="p")
levels(answers_raw$conditions)
```


**Exclude items with extreme read time:**

```{r}
with(answers_raw, plot(read_time, col=id, pch='o', main="Reading time in all trials"))
```

```{r}
for(i in unique(answers_raw$item_num_only)) {
  outliers <- boxplot(answers_raw[answers_raw$item_num_only == i, ]$read_time, plot = FALSE)$out
  answers_raw[answers_raw$item_num_only == i & answers_raw$read_time %in% outliers, ]$read_time <- NA
}
```


```{r}
answers <- answers_raw[is.na(answers_raw$read_time) == FALSE, ]
kable(head(answers_raw))
```

```{r}
with(answers, plot(read_time, col=id, pch='o', main="Reading time in all trials"))
```


**Check number of items after removing outliers:**

```{r}
table(answers$item_num_only)
table(answers$conditions)
table(answers$list)
```


# 2. Fit models

## 2.1 Model 1: 

* without estimator (intercept only)
* using only random intercepts

```{r}
model1 <- clmm(response_1 ~ conditions + (1|item_num_only) + (1|id), data=answers, link="logit", Hess=TRUE) # ID and item as random effect
summary(model1)
```


## 2.2 Model 2: 

* with estimator 
* fitting random intercepts and random slopes
* with slope/intercept correlation

```{r}
model2 <- clmm(response_1 ~ conditions + (conditions|item_num_only) + (conditions|id), data=answers, link="logit", Hess=TRUE)
summary(model2)
```


## 2.3 Model 3: 

* with estimator
* fitting random intercepts and random slopes
* without slope/intercept correlation

```{r}
model3 <- clmm(response_1 ~ 1 + conditions +  (1|item_num_only) + (0+conditions|item_num_only) + (1|id) + (0+conditions|id), 
                data=answers, link="logit", Hess=TRUE)
summary(model3)
```



# 3. Compare goodness of fit 

Compare models with/without random slope:

```{r}
anova(model1, model2)
```


Compare models with/without correlation estimation between random slopes and random intercepts:

```{r}
anova(model2, model3)
```

**We choose Model 2 as our final model.**

















